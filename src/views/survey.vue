<template>
  <section class="m-survey-page">
    <list ref="lists" :survey-content="surveyContent"></list>
    <!-- <div id="history" class="m-com m-history">
      <div class="m-wrap">
        <div style="height: 90px;"></div>
        <div class="m-wrap-content">
          <div class="m-content">
            <div class="icon"></div>
            <div class="content">
              抗日战争时期诗人光未然在此创作出了《黄河大合唱》的歌词。主要景观有：水底冒烟、旱地行船、霓虹戏水、晴空洒雨、旱天鸣雷、冰峰倒挂、山飞海立、十里龙槽、石窝宝镜、孟门夜月、女娇望夫、明清码头等20多个。1988年黄河壶口被国务院确定为国家重点风景名胜区，1992年被评为“中国旅游胜地四十佳”之一，2002年被国土资源部评为国家地质公园及地质遗迹保护区，2008年被评为国家4A级旅游景区。1999年6月18日，江泽民同志视察黄河时，面对百丈飞瀑，挥笔写下“黄河壶口瀑布”六个大字。相继还有李鹏、朱镕基、李瑞环、吴邦国、温家宝等党和国家领导人亲临壶口瀑布，对壶口景区给予了高度的评价和赞誉！“源出昆仑衍大流，玉关九转一壶收”，雄伟壮观的壶口瀑布目前已成为“两黄两圣”和陕北红色旅游线路的重要组成部分，是亿万华夏儿女心之所归、梦之所盼的人文圣地，为世界所瞩目。
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="culture" class="m-com m-culture">
      <div class="m-wrap">
        <div class="m-wrap-content">
          <div class="m-content">
            <div class="icon"></div>
            <div class="content">
              抗日战争时期诗人光未然在此创作出了《黄河大合唱》的歌词。主要景观有：水底冒烟、旱地行船、霓虹戏水、晴空洒雨、旱天鸣雷、冰峰倒挂、山飞海立、十里龙槽、石窝宝镜、孟门夜月、女娇望夫、明清码头等20多个。1988年黄河壶口被国务院确定为国家重点风景名胜区，1992年被评为“中国旅游胜地四十佳”之一，2002年被国土资源部评为国家地质公园及地质遗迹保护区，2008年被评为国家4A级旅游景区。1999年6月18日，江泽民同志视察黄河时，面对百丈飞瀑，挥笔写下“黄河壶口瀑布”六个大字。相继还有李鹏、朱镕基、李瑞环、吴邦国、温家宝等党和国家领导人亲临壶口瀑布，对壶口景区给予了高度的评价和赞誉！“源出昆仑衍大流，玉关九转一壶收”，雄伟壮观的壶口瀑布目前已成为“两黄两圣”和陕北红色旅游线路的重要组成部分，是亿万华夏儿女心之所归、梦之所盼的人文圣地，为世界所瞩目。
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="geo" class="m-com m-geo">
      <div class="m-wrap">
        <div class="m-wrap-content">
          <div class="m-content">
            <div class="icon"></div>
            <div class="content">
              抗日战争时期诗人光未然在此创作出了《黄河大合唱》的歌词。主要景观有：水底冒烟、旱地行船、霓虹戏水、晴空洒雨、旱天鸣雷、冰峰倒挂、山飞海立、十里龙槽、石窝宝镜、孟门夜月、女娇望夫、明清码头等20多个。1988年黄河壶口被国务院确定为国家重点风景名胜区，1992年被评为“中国旅游胜地四十佳”之一，2002年被国土资源部评为国家地质公园及地质遗迹保护区，2008年被评为国家4A级旅游景区。1999年6月18日，江泽民同志视察黄河时，面对百丈飞瀑，挥笔写下“黄河壶口瀑布”六个大字。相继还有李鹏、朱镕基、李瑞环、吴邦国、温家宝等党和国家领导人亲临壶口瀑布，对壶口景区给予了高度的评价和赞誉！“源出昆仑衍大流，玉关九转一壶收”，雄伟壮观的壶口瀑布目前已成为“两黄两圣”和陕北红色旅游线路的重要组成部分，是亿万华夏儿女心之所归、梦之所盼的人文圣地，为世界所瞩目。
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="source" class="m-com m-source">
      <div class="m-wrap">
        <div class="m-wrap-content">
          <div class="m-content">
            <div class="icon"></div>
            <div class="content">
              抗日战争时期诗人光未然在此创作出了《黄河大合唱》的歌词。主要景观有：水底冒烟、旱地行船、霓虹戏水、晴空洒雨、旱天鸣雷、冰峰倒挂、山飞海立、十里龙槽、石窝宝镜、孟门夜月、女娇望夫、明清码头等20多个。1988年黄河壶口被国务院确定为国家重点风景名胜区，1992年被评为“中国旅游胜地四十佳”之一，2002年被国土资源部评为国家地质公园及地质遗迹保护区，2008年被评为国家4A级旅游景区。1999年6月18日，江泽民同志视察黄河时，面对百丈飞瀑，挥笔写下“黄河壶口瀑布”六个大字。相继还有李鹏、朱镕基、李瑞环、吴邦国、温家宝等党和国家领导人亲临壶口瀑布，对壶口景区给予了高度的评价和赞誉！“源出昆仑衍大流，玉关九转一壶收”，雄伟壮观的壶口瀑布目前已成为“两黄两圣”和陕北红色旅游线路的重要组成部分，是亿万华夏儿女心之所归、梦之所盼的人文圣地，为世界所瞩目。
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="letters" class="m-com m-letters">
      <div class="m-wrap">
        <div class="m-wrap-content">
          <div class="m-content">
            <div class="icon"></div>
            <div class="content">
              抗日战争时期诗人光未然在此创作出了《黄河大合唱》的歌词。主要景观有：水底冒烟、旱地行船、霓虹戏水、晴空洒雨、旱天鸣雷、冰峰倒挂、山飞海立、十里龙槽、石窝宝镜、孟门夜月、女娇望夫、明清码头等20多个。1988年黄河壶口被国务院确定为国家重点风景名胜区，1992年被评为“中国旅游胜地四十佳”之一，2002年被国土资源部评为国家地质公园及地质遗迹保护区，2008年被评为国家4A级旅游景区。1999年6月18日，江泽民同志视察黄河时，面对百丈飞瀑，挥笔写下“黄河壶口瀑布”六个大字。相继还有李鹏、朱镕基、李瑞环、吴邦国、温家宝等党和国家领导人亲临壶口瀑布，对壶口景区给予了高度的评价和赞誉！“源出昆仑衍大流，玉关九转一壶收”，雄伟壮观的壶口瀑布目前已成为“两黄两圣”和陕北红色旅游线路的重要组成部分，是亿万华夏儿女心之所归、梦之所盼的人文圣地，为世界所瞩目。
            </div>
          </div>
        </div>
      </div>
    </div> -->
    <anchor ref="anchor" :survey-anchor="surveyAnchor" :active-id="activeId" @changeAnchor="changeAnchor"></anchor>
    <!-- <div class="m-anchor-list">
      <a href="#history" class="m-anchor active" @click="handleClick">
        <span class="u-anchor"></span>
        <span class="text">历史</span>
      </a>
      <a href="#culture" class="m-anchor">
        <span class="u-anchor"></span>
        <span class="text">文化</span>
      </a>
      <a href="#geo" class="m-anchor">
        <span class="u-anchor"></span>
        <span class="text">地理</span>
      </a>
      <a href="#source" class="m-anchor">
        <span class="u-anchor"></span>
        <span class="text">资源</span>
      </a>
      <a href="#letters" class="m-anchor">
        <span class="u-anchor"></span>
        <span class="text">美文</span>
      </a>
    </div> -->
  </section>
</template>
<script>
import dataset from '@/config/dataset'
import List from '@/components/survey/List.vue'
import Anchor from '@/components/survey/Anchor.vue'
import { mapGetters } from 'vuex'
// import { setTimeout } from 'timers';
export default {
  components: {
    List,
    Anchor
  },
  data () {
    return {
      surveyContent: dataset.surveyContent,
      surveyAnchor: dataset.surveyAnchor,
      activeId: dataset.surveyAnchor[0].id,
      // 点击导航页面滚动
      isClick: false,
      timer: null,
      scrollTop: 0
    }
  },
  computed: {
    ...mapGetters(['getHeaderHeight'])
  },
  mounted () {
    console.log('page', this.getHeaderHeight)
    window.addEventListener('scroll', this.handleScroll, true)
  },
  methods: {
    async changeAnchor (id) {
      this.timer && await clearTimeout(this.timer)
      this.activeId = id
      this.isClick = true
      const _that = this
      const top = this.$refs['lists'].$refs[id][0].offsetTop + this.getHeaderHeight || 118
      this.scrollTop = document.documentElement.scrollTop + document.body.scrollTop
      let distance = 0
      if (top > this.scrollTop) {
        // down
        distance = (top - this.scrollTop) / 10
        moveDown()
      } else {
        // up
        distance = (this.scrollTop - top) / 10
        moveUp()
      }
      function moveDown () {
        if (_that.scrollTop < top) {
          _that.scrollTop += distance
          document.body.scrollTop ? (document.body.scrollTop = _that.scrollTop) : (document.documentElement.scrollTop = _that.scrollTop)
          _that.timer = setTimeout(moveDown, 50)
        } else {
          _that.scrollTop = top
          _that.isClick = false
          _that.timer = null
          // _that.timer && await clearTimeout(_that.timer)
        }
      }
      function moveUp () {
        if (_that.scrollTop > top) {
          _that.scrollTop -= distance
          document.body.scrollTop ? (document.body.scrollTop = _that.scrollTop) : (document.documentElement.scrollTop = _that.scrollTop)
          _that.timer = setTimeout(moveUp, 50)
        } else {
          _that.scrollTop = top
          _that.isClick = false
          _that.timer = null
          // _that.timer && await clearTimeout(_that.timer)
        }
      }
    },
    handleScroll () {
      if (this.isClick) {
        return
      }
      const items = document.querySelectorAll('.m-list-survey')
      items.forEach((item, index) => {
        const top = item.offsetTop + this.getHeaderHeight || 118
        const max = item.clientHeight + top
        const scrollTop = document.documentElement.scrollTop + document.body.scrollTop
        const rectTop = item.getBoundingClientRect().top
        if (scrollTop <= max && rectTop <= 0) {
          this.activeId = item.id
        }
      })
    }
  }
}
</script>
<style lang="stylus" scoped>
.m-survey-page {
  position relative
  >>> .m-com {
    width 100%
    .m-wrap {
      margin 0 auto
      width 1199px
      height 100%
      .m-wrap-content {
        position relative
        margin 0 auto
        width 1030px
        height 100%
        background rgba(0, 0, 0, .5)
        .m-content {
          position absolute
          top 50%
          left 50%
          width 760px
          transform translate(-50%, -50%)
          color #ffffff
          font-size 14px
          .icon  {
            margin-bottom 40px
          }
          .content {
            line-height 30px
            .para{
              padding-bottom 20px
            }
          }
        }
      }
    }
    &:first-child .m-wrap .m-wrap-content {
      height calc(100% - 90px)
      .m-content{
        margin-top -90px
      }
    }
  }
  >>> .m-history {
    height 961px
    background url('~@/assets/img/hkgk/historyP.jpg') no-repeat center
    .m-content {
      .icon {
        width 224px
        height 80px
        background url('~@/assets/img/hkgk/icon-history.png') no-repeat center
      }
    }
  }
  >>> .m-culture {
    height 1080px
    background url('~@/assets/img/hkgk/cultureP.jpg') no-repeat center
    .m-content {
      .icon {
        width 224px
        height 79px
        background url('~@/assets/img/hkgk/icon-culture.png') no-repeat center
      }
    }
  }
  >>> .m-geo {
    height 1080px
    background url('~@/assets/img/hkgk/geoP.jpg') no-repeat center
    .m-content {
      .icon {
        width 225px
        height 81px
        background url('~@/assets/img/hkgk/icon-geo.png') no-repeat center
      }
    }
  }
  >>> .m-source {
    height 1080px
    background url('~@/assets/img/hkgk/sourceP.jpg') no-repeat center
    .m-content {
      .icon {
        width 224px
        height 86px
        background url('~@/assets/img/hkgk/icon-source.png') no-repeat center
      }
    }
  }
  >>> .m-letters {
    height 1083px
    background url('~@/assets/img/hkgk/lettersP.jpg') no-repeat center
    .m-content {
      .icon {
        width 217px
        height 82px
        background url('~@/assets/img/hkgk/icon-letters.png') no-repeat center
      }
    }
  }
  >>> .m-anchor-list {
    position fixed
    top 50%
    right 50%
    width 90px
    margin-top -120px
    margin-right 590px
    .m-anchor {
      display block
      line-height 25px
      font-size 20px
      color #ffffff
      .u-anchor {
        display inline-block
        position relative
        margin-right 14px
        width 25px
        height 25px
        border 1px solid transparent
        border-radius 50%
        vertical-align middle
        &:after {
          position absolute
          top 50%
          left 50%
          transform translate(-50%, -50%)
          content ''
          width 15px
          height 15px
          background #ffffff
          border-radius 50%
        }
      }
      &.active .u-anchor {
        border 1px solid #ffffff
      }
      .text {
        vertical-align middle
      }
    }
    .m-anchor + .m-anchor {
      margin-top 25px
    }
  }
}
</style>
